---
title: "My Notebook"
output: html_notebook
---


```{r echo = FALSE}
library(tidyverse)
library(maps)
library(mapdata)
library(maptools)
library(rgdal)
library(ggmap)
library(broom)
```

```{r echo=FALSE}
dir <- "/net/home/h05/irushby/github/Climate_hackathon/Met-Office-Climate-Data-Challenge-May-2022/Climate_Crime_Inequality"
gini_data <- readr::read_csv(file.path(dir, "Gini_coeff.csv"),
                             skip=7,
                             col_names = c("Region", "July_2006_June_2008", "April_2016_March_2018"))
ifs_data <- readr::read_csv(file.path(dir, "inequality_ifs.csv"), skip=2)
hist_crime <- readr::read_csv(file.path(dir, "historical_crime.csv"))[3:14,]
crime_2016 <- readr::read_csv(file.path(dir, "data_2016.csv"))

crime_data <- readr::read_csv(file.path(dir, "combined_crime.csv"))
region_shape <- readOGR(dsn = file.path(dir, "Region_shape"), layer= "RGN_DEC_2021_EN_BFC")
county_shape <- readOGR(dsn=file.path(dir, "County_shape"), layer="CTYUA_DEC_2021_UK_BFC")
map_data = tidy(region_shape)
county_data = tidy(county_shape)

```

```{r}
gini_data
```

Combine Gini and crime data
```{r}
crime_data$Region[crime_data$Region == "Yorkshire and the Humber"] = "Yorks and the Humber"
crime_data$Region[crime_data$Region == "West Midlands Region"] = "West Midlands"
crime_data$Region[crime_data$Region == "East"] = "East of England"
crime_and_gini <- left_join(crime_data, dplyr::select(gini_data, Region, Gini_coeff = April_2016_March_2018))
crime_and_gini <- mutate(crime_and_gini, Violent_crime = (`Violence against the person` + `Homicide` + `Violence with injury` + `Violence without injury`)/4)
```

Summarise violent crime over regions
```{r}
crime_and_gini_mean <- group_by(crime_and_gini, Region) %>% summarise(across(c("Violent_crime", "Gini_coeff"), mean))
ggplot(group_by(crime_and_gini_mean)) + geom_point(aes(x = Gini_coeff, y = Violent_crime, col=Region))

```

Combine region shape with regional crime and Gini data
```{r}
region_ids <- data.frame(Region = c("North East", "North West", "Yorks and the Humber", "East Midlands", "West Midlands", "East of England", "London","South East", "South West"),
                         id = as.character(unique(region_shape@data$OBJECTID) - 1))
map_data <- left_join(map_data, region_ids, by="id") %>% left_join(crime_and_gini_mean, by="Region")
```

```{r}
ggplot(arrange(map_data, id, order)) +  geom_polygon(aes(x=long, y=lat, group = id, fill=Gini_coeff)) + coord_equal()
ggplot(arrange(map_data, id, order)) +  geom_polygon(aes(x=long, y=lat, group = id, fill=Violent_crime)) + coord_equal()
````



```{r}
ifs_data
ifs_gini_data <- filter(ifs_data, Country=="UK") %>% dplyr::select(Year, Gini = `Gini coefficient`)
ifs_gini_data
``` 



```{r}
ggplot(arrange(gini_data, (April_2016_March_2018))) +
  geom_col(aes(factor(Region, levels=unique(Region)), April_2016_March_2018)) +
  xlab("Region") + ylab("Gini Coefficient") + coord_flip(ylim=c(50,NA))
```
```{r}
crime_vars = names(crime_2016)
crime_vars = crime_vars[4: length(crime_vars) - 1]

for (var in crime_vars) {
  ggplot(dplyr::rename(crime_and_gini, var:= {{var}})) +
  geom_col(aes(x=`Area Name`, var, fill=Region)) +
  xlab(var) + ylab("Total recorded crime") + coord_flip()
  ggsave(file.path(dir, paste(var, ".png")))
}

```

Take population data and find rates per 100,000 people
Aggregate over whole region

Plot crime variables 
Plot crime and Gini together
```{r}
ggplot(crime_and_gini) + geom_point(aes(Gini_coeff, `Total recorded crime (excluding fraud)`, col = Region))
```



